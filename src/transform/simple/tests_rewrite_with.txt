$ rewrites with statement

with a as b:
    c
=
_dp_with_enter_1 = __dp__.with_enter(a)
b = __dp__.getitem(_dp_with_enter_1, 0)
_dp_with_exit_2 = __dp__.getitem(_dp_with_enter_1, 1)
_dp_with_active_3 = True
try:
    c
except:
    _dp_with_active_3 = False
    __dp__.with_exit(_dp_with_exit_2, __dp__.exc_info())
finally:
    if _dp_with_active_3:
        __dp__.with_exit(_dp_with_exit_2, None)
    _dp_with_exit_2 = None
    _dp_with_enter_1 = None

$ rewrites multiple with statement

with a as b, c as d:
    e
=
_dp_with_enter_4 = __dp__.with_enter(a)
b = __dp__.getitem(_dp_with_enter_4, 0)
_dp_with_exit_5 = __dp__.getitem(_dp_with_enter_4, 1)
_dp_with_active_6 = True
try:
    _dp_with_enter_1 = __dp__.with_enter(c)
    d = __dp__.getitem(_dp_with_enter_1, 0)
    _dp_with_exit_2 = __dp__.getitem(_dp_with_enter_1, 1)
    _dp_with_active_3 = True
    try:
        e
    except:
        _dp_with_active_3 = False
        __dp__.with_exit(_dp_with_exit_2, __dp__.exc_info())
    finally:
        if _dp_with_active_3:
            __dp__.with_exit(_dp_with_exit_2, None)
        _dp_with_exit_2 = None
        _dp_with_enter_1 = None
except:
    _dp_with_active_6 = False
    __dp__.with_exit(_dp_with_exit_5, __dp__.exc_info())
finally:
    if _dp_with_active_6:
        __dp__.with_exit(_dp_with_exit_5, None)
    _dp_with_exit_5 = None
    _dp_with_enter_4 = None

$ rewrites async with statement

async def f():
    async with a as b:
        c
=
async def _dp_fn_f():
    _dp_with_enter_1 = await __dp__.with_aenter(a)
    b = __dp__.getitem(_dp_with_enter_1, 0)
    _dp_with_exit_2 = __dp__.getitem(_dp_with_enter_1, 1)
    _dp_with_active_3 = True
    try:
        c
    except:
        _dp_with_active_3 = False
        await __dp__.with_aexit(_dp_with_exit_2, __dp__.exc_info())
    finally:
        if _dp_with_active_3:
            await __dp__.with_aexit(_dp_with_exit_2, None)
        _dp_with_exit_2 = None
        _dp_with_enter_1 = None
f = __dp__.update_fn(_dp_fn_f, None, "f")
del _dp_fn_f

$ rewrites with starred target

with a as (b, *c):
    pass
=
_dp_with_enter_1 = __dp__.with_enter(a)
_dp_tmp_4 = __dp__.getitem(_dp_with_enter_1, 0)
_dp_tmp_5 = __dp__.unpack(_dp_tmp_4, (True, False))
b = __dp__.getitem(_dp_tmp_5, 0)
c = __dp__.tuple(__dp__.getitem(_dp_tmp_5, 1))
_dp_tmp_5 = None
_dp_tmp_4 = None
_dp_with_exit_2 = __dp__.getitem(_dp_with_enter_1, 1)
_dp_with_active_3 = True
try:
    pass
except:
    _dp_with_active_3 = False
    __dp__.with_exit(_dp_with_exit_2, __dp__.exc_info())
finally:
    if _dp_with_active_3:
        __dp__.with_exit(_dp_with_exit_2, None)
    _dp_with_exit_2 = None
    _dp_with_enter_1 = None
