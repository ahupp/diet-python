$ class global classcell

def exercise():
    class X:
        global __class__
        __class__ = 42
        def f(self):
            return __class__
    x = X()
    value = x.f()
    global_value = globals()["__class__"]
    del globals()["__class__"]
    return value, global_value, X
=
def _dp_fn_exercise():

    def _dp_create_class_exercise__locals__X():

        def _dp_ns_builder(_dp_class_ns):

            def _dp_lambda_1():
                return __name__$0
            _dp_lambda_1 = __dp__.update_fn(_dp_lambda_1, "exercise.<locals>.<lambda>", "<lambda>")
            _dp_class_ns.__module__ = __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_1)
            _dp_class_ns.__qualname__ = "exercise.<locals>.X"
            _dp_classcell = __dp__.empty_classcell()

            def _dp_lambda_2():
                return _dp_classcell
            _dp_lambda_2 = __dp__.update_fn(_dp_lambda_2, "exercise.<locals>.<lambda>", "<lambda>")
            _dp_class_ns.__classcell__ = __dp__.getitem(_dp_lambda_2.__closure__, 0)
            __class__$0 = 42

            def _dp_fn_f(self):
                return __dp__.class_cell_value(_dp_classcell)
            _dp_class_ns.f = __dp__.update_fn(_dp_fn_f, "exercise.<locals>.X", "f")
        return __dp__.create_class("X", _dp_ns_builder, (), None)
    X = _dp_create_class_exercise__locals__X()
    x = X()
    value = x.f()
    global_value = __dp__.getitem(globals$0(), "__class__")
    __dp__.delitem(globals$0(), "__class__")
    return value, global_value, X
exercise = __dp__.update_fn(_dp_fn_exercise, None, "exercise")
del _dp_fn_exercise
