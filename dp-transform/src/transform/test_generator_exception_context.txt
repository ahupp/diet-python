$ generator exception context
class CaptureException:
    def __enter__(self):
        return self

    def __exit__(self, exc_type, exc, tb):
        self.exc = exc
        return True


def exception_context():
    def f():
        try:
            raise KeyError("a")
        except Exception:
            yield

    gen = f()
    gen.send(None)
    capture = CaptureException()
    with capture:
        gen.throw(ValueError)
    context = capture.exc.__context__
    return type(context), context.args
=
def _dp_ns_CaptureException(_dp_class_ns):

    def _dp_lambda_4():
        return __name__
    _dp_lambda_4 = __dp__.update_fn(_dp_lambda_4, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_4))
    __dp__.setattr(_dp_class_ns, "__qualname__", "CaptureException")

    def __enter__(self):
        return self

    def _dp_lambda_5():
        return __enter__
    _dp_lambda_5 = __dp__.update_fn(_dp_lambda_5, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__enter__", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "__enter__", _dp_lambda_5), "CaptureException", "<locals>"))

    def __exit__(self, exc_type, exc, tb):
        __dp__.setattr(self, "exc", exc)
        return True

    def _dp_lambda_6():
        return __exit__
    _dp_lambda_6 = __dp__.update_fn(_dp_lambda_6, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__exit__", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "__exit__", _dp_lambda_6), "CaptureException", "<locals>"))
CaptureException = __dp__.create_class("CaptureException", _dp_ns_CaptureException, (), None)
def exception_context():

    def f():
        try:
            raise KeyError("a")
        except:
            if __dp__.exception_matches(__dp__.current_exception(), Exception):
                yield
            else:
                raise
    gen = f()
    gen.send(None)
    capture = CaptureException()
    _dp_tmp_2 = __dp__.with_enter(capture)
    try:
        _dp_tmp_3 = __dp__.unpack(_dp_tmp_2, (True, True))
        _ = __dp__.getitem(_dp_tmp_3, 0)
        _dp_with_exit_1 = __dp__.getitem(_dp_tmp_3, 1)
    finally:
        _dp_tmp_3 = None
        _dp_tmp_2 = None
    try:
        gen.throw(ValueError)
    except:
        __dp__.with_exit(_dp_with_exit_1, __dp__.exc_info())
    else:
        __dp__.with_exit(_dp_with_exit_1, None)
    finally:
        _dp_with_exit_1 = None
    context = capture.exc.__context__
    return type(context), context.args
