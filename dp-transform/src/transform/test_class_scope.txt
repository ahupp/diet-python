$ class scope integration
results = {}

x = "global"
class C1:
    x = "class"
    def read():
        return x
results["class_attr_vs_global"] = (C1.x, C1.read(), x)

x = "module"
class C2:
    global x
    x = "class-global"
    y = "class-attr"
results["class_global_assignment"] = (x, getattr(C2, "x", None), C2.y)

x = "module"
class C3:
    def set_x():
        global x
        x = "method-global"
    def read_x():
        return x
C3.set_x()
results["class_method_global_assignment"] = (x, C3.read_x())

class C4:
    def outer():
        x = "outer"
        def inner():
            nonlocal x
            x = "inner"
        inner()
        return x
results["class_method_nonlocal_inner"] = C4.outer()

def outer_with_inner_class():
    x = "outer"
    class Inner:
        y = x
    return Inner.y
results["def_with_inner_class_capture"] = outer_with_inner_class()

x = "module"
def outer_with_inner_class_global_assignment():
    x = "outer"
    class Inner:
        global x
        x = "class-global"
        y = "class-attr"
    return (x, getattr(Inner, "x", None), Inner.y)
results["def_with_inner_class_global_assignment"] = (outer_with_inner_class_global_assignment(), x)

x = "module"
def outer_with_class_method_reads_global():
    x = "outer"
    class Inner:
        x = "class"
        def read():
            return x
    return (Inner.x, Inner.read(), x)
results["def_with_class_with_method_reads_global"] = outer_with_class_method_reads_global()

def outer_with_nonlocal_and_inner_class():
    x = "outer"
    def inner():
        nonlocal x
        x = "inner"
        class Inner:
            y = x
        return Inner.y
    y = inner()
    return (x, y)
results["def_with_nonlocal_and_inner_class"] = outer_with_nonlocal_and_inner_class()

def nonlocal_in_class_body_error():
    try:
        exec("class Bad:\\n    nonlocal x\\n")
    except SyntaxError as exc:
        return exc.msg
    return None
results["class_nonlocal_syntaxerror"] = nonlocal_in_class_body_error()
=
results = __dp__.dict()
x = "global"
def _dp_ns_C1(_dp_class_ns):

    def _dp_lambda_1():
        return __name__$0
    _dp_lambda_1 = __dp__.update_fn(_dp_lambda_1, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_1))
    __dp__.setattr(_dp_class_ns, "__qualname__", "C1")
    __dp__.setattr(_dp_class_ns, "x", "class")

    def read():
        return x$0

    def _dp_lambda_2():
        return read$0
    _dp_lambda_2 = __dp__.update_fn(_dp_lambda_2, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "read", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "read", _dp_lambda_2), "C1", "<locals>"))
C1 = __dp__.create_class("C1", _dp_ns_C1, (), None)
__dp__.setitem(results, "class_attr_vs_global", (C1.x, C1.read(), x))
x = "module"
def _dp_ns_C2(_dp_class_ns):

    def _dp_lambda_3():
        return __name__$0
    _dp_lambda_3 = __dp__.update_fn(_dp_lambda_3, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_3))
    __dp__.setattr(_dp_class_ns, "__qualname__", "C2")
    x$0 = "class-global"
    __dp__.setattr(_dp_class_ns, "y", "class-attr")
C2 = __dp__.create_class("C2", _dp_ns_C2, (), None)
__dp__.setitem(results, "class_global_assignment", (x, getattr(C2, "x", None), C2.y))
x = "module"
def _dp_ns_C3(_dp_class_ns):

    def _dp_lambda_4():
        return __name__$0
    _dp_lambda_4 = __dp__.update_fn(_dp_lambda_4, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_4))
    __dp__.setattr(_dp_class_ns, "__qualname__", "C3")

    def set_x():
        x$0 = "method-global"

    def _dp_lambda_5():
        return set_x$0
    _dp_lambda_5 = __dp__.update_fn(_dp_lambda_5, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "set_x", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "set_x", _dp_lambda_5), "C3", "<locals>"))

    def read_x():
        return x$0

    def _dp_lambda_6():
        return read_x$0
    _dp_lambda_6 = __dp__.update_fn(_dp_lambda_6, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "read_x", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "read_x", _dp_lambda_6), "C3", "<locals>"))
C3 = __dp__.create_class("C3", _dp_ns_C3, (), None)
C3.set_x()
__dp__.setitem(results, "class_method_global_assignment", (x, C3.read_x()))
def _dp_ns_C4(_dp_class_ns):

    def _dp_lambda_7():
        return __name__$0
    _dp_lambda_7 = __dp__.update_fn(_dp_lambda_7, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_7))
    __dp__.setattr(_dp_class_ns, "__qualname__", "C4")

    def outer():
        x = "outer"

        def inner():
            x$1 = "inner"
        inner()
        return x

    def _dp_lambda_8():
        return outer$0
    _dp_lambda_8 = __dp__.update_fn(_dp_lambda_8, None, "<lambda>")
    __dp__.setattr(_dp_class_ns, "outer", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "outer", _dp_lambda_8), "C4", "<locals>"))
C4 = __dp__.create_class("C4", _dp_ns_C4, (), None)
__dp__.setitem(results, "class_method_nonlocal_inner", C4.outer())
def outer_with_inner_class():
    x = "outer"

    def _dp_ns_Inner(_dp_class_ns):

        def _dp_lambda_9():
            return __name__$0
        _dp_lambda_9 = __dp__.update_fn(_dp_lambda_9, "outer_with_inner_class.<locals>", "<lambda>")
        __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_9))
        __dp__.setattr(_dp_class_ns, "__qualname__", "outer_with_inner_class.<locals>.Inner")

        def _dp_lambda_10():
            return x$1
        _dp_lambda_10 = __dp__.update_fn(_dp_lambda_10, "outer_with_inner_class.<locals>", "<lambda>")
        __dp__.setattr(_dp_class_ns, "y", __dp__.class_lookup(_dp_class_ns, "x", _dp_lambda_10))
    Inner = __dp__.create_class("Inner", _dp_ns_Inner, (), None)
    return Inner.y
__dp__.setitem(results, "def_with_inner_class_capture", outer_with_inner_class())
x = "module"
def outer_with_inner_class_global_assignment():
    x = "outer"

    def _dp_ns_Inner(_dp_class_ns):

        def _dp_lambda_11():
            return __name__$0
        _dp_lambda_11 = __dp__.update_fn(_dp_lambda_11, "outer_with_inner_class_global_assignment.<locals>", "<lambda>")
        __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_11))
        __dp__.setattr(_dp_class_ns, "__qualname__", "outer_with_inner_class_global_assignment.<locals>.Inner")
        x$0 = "class-global"
        __dp__.setattr(_dp_class_ns, "y", "class-attr")
    Inner = __dp__.create_class("Inner", _dp_ns_Inner, (), None)
    return x, getattr$0(Inner, "x", None), Inner.y
__dp__.setitem(results, "def_with_inner_class_global_assignment", (outer_with_inner_class_global_assignment(), x))
x = "module"
def outer_with_class_method_reads_global():
    x = "outer"

    def _dp_ns_Inner(_dp_class_ns):

        def _dp_lambda_12():
            return __name__$0
        _dp_lambda_12 = __dp__.update_fn(_dp_lambda_12, "outer_with_class_method_reads_global.<locals>", "<lambda>")
        __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_12))
        __dp__.setattr(_dp_class_ns, "__qualname__", "outer_with_class_method_reads_global.<locals>.Inner")
        __dp__.setattr(_dp_class_ns, "x", "class")

        def read():
            return x$1

        def _dp_lambda_13():
            return read$0
        _dp_lambda_13 = __dp__.update_fn(_dp_lambda_13, "outer_with_class_method_reads_global.<locals>", "<lambda>")
        __dp__.setattr(_dp_class_ns, "read", __dp__.update_fn(__dp__.class_lookup(_dp_class_ns, "read", _dp_lambda_13), "outer_with_class_method_reads_global.<locals>.Inner", "<locals>"))
    Inner = __dp__.create_class("Inner", _dp_ns_Inner, (), None)
    return Inner.x, Inner.read(), x
__dp__.setitem(results, "def_with_class_with_method_reads_global", outer_with_class_method_reads_global())
def outer_with_nonlocal_and_inner_class():
    x = "outer"

    def inner():
        x$1 = "inner"

        def _dp_ns_Inner(_dp_class_ns):

            def _dp_lambda_14():
                return __name__$0
            _dp_lambda_14 = __dp__.update_fn(_dp_lambda_14, "outer_with_nonlocal_and_inner_class.<locals>.inner.<locals>", "<lambda>")
            __dp__.setattr(_dp_class_ns, "__module__", __dp__.class_lookup(_dp_class_ns, "__name__", _dp_lambda_14))
            __dp__.setattr(_dp_class_ns, "__qualname__", "outer_with_nonlocal_and_inner_class.<locals>.inner.<locals>.Inner")

            def _dp_lambda_15():
                return x$1
            _dp_lambda_15 = __dp__.update_fn(_dp_lambda_15, "outer_with_nonlocal_and_inner_class.<locals>.inner.<locals>", "<lambda>")
            __dp__.setattr(_dp_class_ns, "y", __dp__.class_lookup(_dp_class_ns, "x", _dp_lambda_15))
        Inner = __dp__.create_class("Inner", _dp_ns_Inner, (), None)
        return Inner.y
    y = inner()
    return x, y
__dp__.setitem(results, "def_with_nonlocal_and_inner_class", outer_with_nonlocal_and_inner_class())
def nonlocal_in_class_body_error():
    try:
        exec$0("class Bad:\\n    nonlocal x\\n")
    except:
        if __dp__.exception_matches(__dp__.current_exception(), SyntaxError$0):
            exc = __dp__.current_exception()
            try:
                return exc.msg
            finally:
                try:
                    del exc
                except:
                    if __dp__.exception_matches(__dp__.current_exception(), NameError$0):
                        pass
                    else:
                        raise
        else:
            raise
    return None
__dp__.setitem(results, "class_nonlocal_syntaxerror", nonlocal_in_class_body_error())
